---
title: "scicur-study1"
output:
  html_document:
    theme: cosmo
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: false
---

# Libraries
```{r load-libs, message=F, warning=F}
library(rio)
library(here)
library(tidyverse)
library(janitor)
library(ggplot2)
```

# Import Joined Data (df1)
Loading a single dataframe that has already been prepped in a different document.
It includes both the baseline and study 1 data, matched by MTurk ID. 

It is already excluding:

* Duplicates
* Unfinished responses
* Responses where Ss reported cheating
* Responses where Ss reported bad response
* Unapproved responses
* Responses where Ss did not consent
* Responses that were not in both dfs (b and s1)

```{r import-data}
df1 <- import(here("prepped-data", "joined-data.csv"))
```

# Cleaning (df2)
```{r org-cols}
df2 <- df1 %>%
  select(id, batch, contains("duration_in_seconds"), contains("2_1_sc"), 
         contains("news1"), contains("act"), contains("books"), contains("convo"),
         contains("share_freq"), contains("read_article"), contains("topic_interest"), 
         contains("1_1_sc"), contains("time_page_submit_sc"), 
         contains("rav"), contains("cc_risk"), contains("ccr"),
         contains("dem"), contains("start_date"), contains("end_date"), 
         contains("finished"), contains("consent"), contains("open"), contains("fl_")
         )
```

```{r make-numeric}
df2[3:170] <- lapply(df2[3:170], as.numeric)
df2[172:177] <- lapply(df2[172:177], as.numeric)
```

## Duration
```{r id-dur-outlier}
df2 <- df2 %>% 
  mutate(duration_z = scale(duration_in_seconds_sc),
         duration_ex = case_when(
           duration_z >= 3 ~ "1", # z score duration times to exclude outliers
           duration_z <= -3 ~ "1",
           TRUE ~ "0"
         ))
```

```{r ex-dur}
df2 <- df2 %>% 
  filter(duration_ex != 1)
```

## Political Ideology
```{r score-ideology}
df2 <- df2 %>% 
  mutate(conservatism = dem_annes_id_b, # 1 (ext L), 7 (ext C), 4 = mod
         ideology_lean = dem_annes_id2_b, # 1 = R lean, 2 = neither, 4 = D lean
         ideology_lean2 = case_when(
           dem_annes_id2_b == 1 ~ 4.5,
           dem_annes_id2_b == 2 ~ 4,
           dem_annes_id2_b == 4 ~ 3.5,
           TRUE ~ 999
         ),
         ideology_lean2 = ifelse(ideology_lean2 == 999, NA, ideology_lean2),
         conservatism_f = ifelse(conservatism == 4, ideology_lean2, conservatism),
         con = case_when(
           conservatism_f > 4 ~ 1,
           conservatism_f < 4 ~ -1,
           conservatism_f == 4 ~ 0,
           TRUE ~ 999
         ),
         con = ifelse(con == 999, NA, con),
         party = dem_annes_party_b, # 1 = D, 2 = R, 3 = Indep, 4 = other
         party_str = dem_annes_party_str_b, # 1 = strong, 2 = not very strong
         party_lean = dem_annes_party_lean_b) 
```

```{r check-scoring, eval=F, echo=F}
df2 %>%
  filter(conservatism != 4 & is.na(ideology_lean2) == F) # this works
```

```{r check-id-batch-match}
# checking if batch and ideology match -- it doesn't for all??
df2 <- df2 %>% 
  mutate(batchcon = case_when(
    batch == "con1" ~ 1,
    batch == "con2" ~ 1,
    batch == "lib1" ~ -1,
    batch == "lib2" ~ -1,
    TRUE ~ 999
    ),
    batchcon = ifelse(batchcon == 999, NA, batchcon)
  )

df2_picheck <- df2 %>% 
  select(id, con, batchcon) %>% 
  mutate(batchmatch = ifelse(con == batchcon, 1, 0))

df2_picheck %>% 
  filter(batchmatch == 0) %>% 
  nrow() # all of these ppl got sorted into the wrong HIT, not too much of an issue though

df2_picheck %>% 
  filter(batchmatch == 0) %>% 
  head(10) 
```

### Updated N
Ncon = 227, Nmod = 52, Nlib = 266. Ntot = 545
```{r updated-N}
df2 %>% 
  group_by(con) %>% 
  summarise(n = n())
```

## Demographics
Haven't touched these yet.
```{r demographics}
# gender: dem_gender (_1 = man, _2 = nb, _5 = woman, _3 = other, 
# _4 = prefer not to answer)

# race: dem_race (_1 = white/caucasian, _2 = black/african american,
# _3 = hispanic, _4 = asian, _5 = native hawaiian/pacific islander,
# _6 = american indian, _7 = eskimo aleut, _8 = other, _9 = prefer not to answer)

# native english speaker: dem_lang (1 = yes, 2 = no)

# edu: dem_ed (_1 = <hs, _2 = some hs, _3 = hs/ged, _4 = 2yr college,
# _5 = 4yr college, _6 = masters, _7 = doctoral)

# income: dem_inc (_1 = <10k, _2 = 10-20k, _3 = 20-30k, (...), _11 = 100-150k,
# _12 = 150-200k, _13 = 200-250k, _14 > 250k)
```

# Science Curiosity Scale (df3)
## Recode
```{r recode-scicur}
df3 <- df2 %>%
  mutate(sc_likert = news1_2_sc + news1_6_sc + convo_2_sc + convo_10_sc +
           topic_interest_3_sc + topic_interest_5_sc + topic_interest_8_sc,
         sc_books = as.numeric(case_when(
           books_3_sc > 0 ~ "1",
           is.na(books_3_sc) == T ~ "0")),
         sc_lecture = as.numeric(case_when(
           act10c1_2_sc > 0 ~ "1",
           is.na(act10c1_2_sc) == T ~ "0")),
         sc_scimu = if_else(act_scib_sc > 0, 1, 0),
         sc_scimu_c19 = if_else(act_scic_sc > 0, 1, 0),
         sc_read = if_else(read_article_sc == 2, 1, 0),
         sc_share_yn = if_else(share_freq1_sc == 1, 0, 1),
         sc_share_tech_na = recode(share_freq2_6_sc, `1` = 1,
                                `2` = 2,
                                `3` = 2,
                                `4` = 2,
                                `5` = 3,
                                `6` = 3,
                                `7` = 4,
                                `8` = 4,
                                `9` = 5,
                                `10` = 5),
         sc_share_tech = ifelse(is.na(sc_share_tech_na) == T, 0, sc_share_tech_na),
         sc_share_sci_na = recode(share_freq2_11_sc, `1` = 1,
                                `2` = 2,
                                `3` = 2,
                                `4` = 2,
                                `5` = 3,
                                `6` = 3,
                                `7` = 4,
                                `8` = 4,
                                `9` = 5,
                                `10` = 5),
         sc_share_sci = ifelse(is.na(sc_share_sci_na) == T, 0, sc_share_sci_na)
         )
```

```{r check-scicur-recode}
df3 %>% 
  select(contains("sc_")) %>% 
  head(10)
```

## Score
```{r score-scicur}
df3 <- df3 %>% # score sci cur
  mutate(sc_score1 = sc_likert + sc_books + sc_lecture + sc_scimu + 
           sc_scimu_c19 + sc_read,
         sc_score2a = sc_share_tech + sc_share_sci,
         sc_score2b = if_else(share_freq1_sc == 0, 0, sc_score2a),
         sc_scored = sc_score1 + sc_score2b,
         sc_scoredz = scale(sc_scored)) # z score

```

## Descriptives
```{r scicur-desc}
df3$sc_scored %>% 
  psych::describe()

df3 %>% 
  ggplot(aes(x = sc_score1)) +
  geom_histogram()
```

# RPM (df4)
## Score
```{r score-rpm}
df4 <- df3 %>% 
  mutate(rav_scored = ravens1_b + ravens2_b + ravens3_b + ravens4_b + ravens5_b +
           ravens6_b + ravens7_b + ravens8_b + ravens9_b + ravens10_b,
         rav_scoredz = scale(rav_scored))

# df4 %>% 
#   select(contains("rav"), -contains("click"), -contains("submit"))

df4 %>% 
  filter(is.na(rav_scored) == T) %>% 
  nrow() # gotta check this out
```

```{r rpm-cols, echo=F, eval=F}
rav_cols <- df4 %>% 
  select(contains("ravens"), -contains("click"), -contains("submit")) %>% 
  colnames()

rav_cols1 <- rep(NA, length(rav_cols))

for (i in 1:length(rav_cols)) {
  
  rav_cols1[i] = paste(cols[i], "sc", sep = "_")

} # change name of raven cols (not done!)

# colnames(dfq1) <- cols1
# 
# dfq1 <- dfq1 %>% 
#   rename(., id = id_sc)
```

## Descriptives
```{r rpm-desc}
df4$rav_scored %>% 
  psych::describe()

df4 %>%
  ggplot(aes(x = rav_scored)) +
  geom_histogram(binwidth = .5)
```

# MR Task (df5)
## Recode
```{r recode-mr}
df5 <- df4 %>% 
  mutate(arctic20e = dplyr::recode(arctic2_1_sc, `1` = 3,
                           `2` = 2,
                           `3` = 1,
                           `4` = 0,
                           `5` = -1,
                           `6` = -2,
                           `7` = -3),
         arctic20z = scale(arctic20e),
         temp20e = dplyr::recode(temp2_1_sc,`1` = -3,
                           `2` = -2,
                           `3` = -1,
                           `4` = 0,
                           `5` = 1,
                           `6` = 2,
                           `7` = 3),
         temp20z = scale(temp20e),
         ozone20e = dplyr::recode(ozone2_1_sc, `1` = 3,
                           `2` = 2,
                           `3` = 1,
                           `4` = 0,   
                           `5` = -1,
                           `6` = -2,
                           `7` = -3),
         ozone20z = scale(ozone20e),
         airqual20e = dplyr::recode(air_qual2_1_sc, `1` = 3,
                           `2` = 2,
                           `3` = 1,
                           `4` = 0,
                           `5` = -1,
                           `6` = -2,
                           `7` = -3),
         airqual20z = scale(airqual20e),
         diatho20e = dplyr::recode(dia_tho2_1_sc, `1` = 3,
                           `2` = 2,
                           `3` = 1,
                           `4` = 0,
                           `5` = -1,
                           `6` = -2,
                           `7` = -3),
         diatho20z = scale(diatho20e),
         co220e = dplyr::recode(co22_1_sc, `1` = -3,
                           `2` = -2,
                           `3` = -1,
                           `4` = 0,
                           `5` = 1,
                           `6` = 2,
                           `7` = 3),
         co220z = scale(co220e),
         icesheets20e = dplyr::recode(ice_sheets2_1_sc, `1` = 3,
                           `2` = 2,
                           `3` = 1,
                           `4` = 0,
                           `5` = -1,
                           `6` = -2,
                           `7` = -3),
         icesheets20z = scale(icesheets20e),
         quake20e = if_else(quake2_1_sc == 0, 0, 1)
         )
```

### Descriptives
```{r check-mr-recode}
df5 %>% 
  select(contains("20e")) %>% 
  psych::describe()
```

```{r plot-mr-z}
df5 %>%
  ggplot(aes(x = arctic20z)) +
  geom_histogram(binwidth = 1)

df5 %>%
  ggplot(aes(x = temp20z)) +
  geom_histogram(binwidth = 1)

df5 %>%
  ggplot(aes(x = ozone20z)) +
  geom_histogram(binwidth = 1)

df5 %>%
  ggplot(aes(x = airqual20z)) +
  geom_histogram(binwidth = 1)
```

```{r plot-mr-e}
df5 %>%
  ggplot(aes(x = arctic20e)) +
  geom_histogram(binwidth = 1)

df5 %>%
  ggplot(aes(x = temp20e)) +
  geom_histogram(binwidth = 1)

df5 %>%
  ggplot(aes(x = ozone20e)) +
  geom_histogram(binwidth = 1)

df5 %>%
  ggplot(aes(x = airqual20e)) +
  geom_histogram(binwidth = 1)
```

All of the MR items are very negatively skewed; most people exhibited endpoint 
bias. We preregistered coding the IMRI so that it was based on z > 1.5, but
that isn't helpful here with this distribution. 

## Score
```{r score-mr}
df5 <- df5 %>% 
  mutate(n_plot_score = diatho20e + co220e + icesheets20e,
         n_plot_score_z = scale(n_plot_score),
         nq_plot_score = n_plot_score + quake20e, 
         nq_plot_score_z = scale(nq_plot_score),
         con_plot = arctic20e + temp20e,
         con_plot_z = scale(con_plot),
         lib_plot = ozone20e + airqual20e,
         lib_plot_z = scale(lib_plot))

df5 <- df5 %>% 
  mutate(bad_plot_score = ifelse(n_plot_score_z <= -3, 1, 0),
         bad_plot_score_q = ifelse(nq_plot_score_z <= -3, 1, 0)
         ) # turns out no diff btwn no q and _q so can just use no q
```

```{r check-ideology-na, echo=F, eval=F}
df5 %>%
  select(contains("annes")) %>%
  filter(is.na(dem_annes_id_b) == T) %>%
  nrow() # ok everyone is partisan labeled
```

## Poor Plot Performance
Only 6 people (~1%) performed exceptionally poorly on the filler plot items.
```{r poor-perf-desc, eval=F, echo=F}
df5 %>% 
  select(contains("bad_plot_score")) %>% 
  psych::describe()

df5 %>% 
  filter(bad_plot_score == 1) %>% 
  nrow()
```

## Attention Check (Practice Item)
A ton of people failed the attention check, which leads me to believe it was
probably not the best attention check. I'll see if this correlates with
anything else important.
```{r attn-check-score-and-desc}
df5 <- df5 %>% 
  mutate(attn_check = if_else(prac2_1_sc == 6, 1, 0),
         attn_check_12 = if_else(prac1_1_sc == prac2_1_sc, 1, 0))

df5 %>% 
  select(contains("attn_check")) %>% 
  psych::describe()
```

# IMRI
So this gets tricky because of the negative skew of the responses for these items.
No one actually has z > 1.5 on any of them, so that scoring method isn't helpful.

```{r prereg-eb-score-desc}
df5 <- df5 %>%
  mutate(ebiasiz15_arctic = ifelse(arctic20z >= 1.5, 1, 0),
         ebiasiz15_temp = ifelse(temp20z >= 1.5, 1, 0),
         ebiasiz15_ozone = ifelse(ozone20z >= 1.5, 1, 0),
         ebiasiz15_airqual = ifelse(airqual20z >= 1.5, 1, 0))

df5 %>% 
  select(contains("ebiasiz15")) %>% 
  psych::describe()
```

## Coding for Above-Average
Here's what happens if we code it based on whether or not they exhibit
above-average endpoint bias (e.g., z > 0).
```{r eb-z-score-desc}
df5 <- df5 %>% 
  mutate(ebiasiz0_arctic = ifelse(arctic20z >= 0, 1, 0),
         ebiasiz0_temp = ifelse(temp20z >= 0, 1, 0),
         ebiasiz0_ozone = ifelse(ozone20z >= 0, 1, 0),
         ebiasiz0_airqual = ifelse(airqual20z >= 0, 1, 0))

df5 %>% 
  select(contains("ebiasiz0")) %>% 
  psych::describe()
```

```{r eb-score-desc}
df5 <- df5 %>% 
  mutate(
    ebiasiz0_con = ebiasiz0_arctic + ebiasiz0_temp,
    ebiasiz0_lib = ebiasiz0_ozone + ebiasiz0_airqual,
    ebiasiz0_con_yn = ifelse(ebiasiz0_con == 2, 1, 0),
    ebiasiz0_lib_yn = ifelse(ebiasiz0_lib == 2, 1, 0),
  )

df5 %>% 
  select(ebiasiz0_con, ebiasiz0_lib, ebiasiz0_con_yn, ebiasiz0_lib_yn) %>% 
  psych::describe()
```

## Coding for Endpoint Bias
Here's what happens if we code it solely based on whether or not they exhibit
endpoint bias at all (e.g., score > 0; the higher the number, the more extreme
their bias)

```{r imri-code}
df5 <- df5 %>% 
  mutate(imri_iz0 = case_when(
    con == 1 ~ ifelse(ebiasiz0_con_yn == 1 & ebiasiz0_lib_yn == 0, 1, 0),
    con == 0 ~ ifelse(ebiasiz0_con_yn == 0 & ebiasiz0_lib_yn == 1, 1, 0),
    TRUE ~ 0
  ))

df5 %>% 
  filter(imri_iz0 == 1) %>% 
  nrow()
```

```{r}
df5 <- df5 %>% 
  mutate(ebiasie_arctic = ifelse(arctic20e > 0, 1, 0),
         ebiasie_temp = ifelse(temp20e > 0, 1, 0),
         ebiasie_ozone = ifelse(ozone20e > 0, 1, 0),
         ebiasie_airqual = ifelse(airqual20e > 0, 1, 0)
  )

df5 %>% 
  select(contains("ebiasie")) %>% 
  psych::describe()
```

```{r}
df5 <- df5 %>% 
  mutate(
    ebiasie_con = ebiasie_arctic + ebiasie_temp,
    ebiasie_lib = ebiasie_ozone + ebiasie_airqual,
    ebiasie_con_yn = ifelse(ebiasie_con == 2, 1, 0),
    ebiasie_lib_yn = ifelse(ebiasie_lib == 2, 1, 0),
  )

df5 %>% 
  select(ebiasie_con, ebiasie_lib, ebiasie_con_yn, ebiasie_lib_yn) %>% 
  psych::describe()
```

```{r}
df5 <- df5 %>% 
  mutate(imri_ie = case_when(
    con == 1 ~ ifelse(ebiasie_con_yn == 1 & ebiasie_lib_yn == 0, 1, 0),
    con == 0 ~ ifelse(ebiasie_con_yn == 0 & ebiasie_lib_yn == 1, 1, 0),
    TRUE ~ 0
  ))

df5 %>% 
  filter(imri_ie == 1) %>% 
  nrow()
```

# Exclude (df6)

Now excluding:

* Duplicates
* Unfinished
* Reported cheating
* Reported bad response
* Unapproved
* Did not consent
* Was not in both dfs (b and s1)
* **Outlier duration**
* **Poor performance on plots**

```{r}
df5 <- df5 %>% 
  filter(bad_plot_score != 1)

df5 %>% 
  nrow()

df5 %>% 
  group_by(con) %>% 
  summarise(n = n())
```

Now excluding:

* Duplicates
* Unfinished
* Reported cheating
* Reported bad response
* Unapproved
* Did not consent
* Was not in both dfs (b and s1)
* **Outlier duration**
* **Poor performance on plots**
* **Failed attention check**

```{r}
df6attn <- df5 %>% 
  filter(attn_check != 1) # basically not feasible bc it's so many ppl

df6attn %>% 
  nrow()

df6attn %>% 
  group_by(con) %>% 
  summarise(n = n())
```

# Save
Final df excluding:

* Duplicates
* Unfinished
* Reported cheating
* Reported bad response
* Unapproved
* Did not consent
* Was not in both dfs (b and s1)
* Outlier duration
* Performed poorly on filler plot items

```{r eval=F}
# Save df (df6)
write.csv(df6, "./analysis-data/cleaned-data.csv")
```

